\documentclass[a4paper,11pt,dvipdfmx]{jsarticle}


% 数式
\usepackage{amsmath,amsfonts}
\usepackage{bm}

% 画像
\usepackage[dvipdfmx]{graphicx}
\usepackage{framed}

% 図形
\usepackage{tikz}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary {shapes.misc}

% ソースコード
\usepackage{listings,jlisting,color}
\lstset{
basicstyle={\ttfamily},
identifierstyle={\small},
commentstyle={\smallitshape},
keywordstyle={\small\bfseries},
ndkeywordstyle={\small},
stringstyle={\small\ttfamily},
frame={tb},
breaklines=true,
columns=[l]{fullflexible},
numbers=left,
xrightmargin=0zw,
xleftmargin=3zw,
numberstyle={\scriptsize},
stepnumber=1,
numbersep=1zw,
lineskip=-0.5ex
}
\renewcommand{\lstlistingname}{ソースコード}


\begin{document}
\definecolor{shadecolor}{gray}{0.70}

\title{最適化 Class-2 演習}
\author{21T2166D 渡辺大樹}
\date{\today}
\maketitle

\section{演習内容}
Class-2では探索における最適化を、関数の最大値を求めるアルゴリズムの設計を用いて理解していく。

今回用いるアルゴリズムは全探索と山登り探索になる。
全探索は決められた定義域における関数の値をすべて求め、そこから最大の値となる関数の値と引数を特定する方法になる。

山登り探索はある初期値から関数の値が大きくなる方へ山に登るように移動し、最大となった点の関数の値と引数を返す方法になる。

この二つの探索を1変数関数と2変数関数で行っていく。
実装したコードはソースコード\ref{ex},\ref{hill},\ref{ex3d},\ref{hill3d}に示す。コードがかなり長いためレポート末に示す。

\subsection{1変数関数での探索}
最大値を求める関数は(1)(2)の2種類を用いる。
\begin{align}
    f(x) &= \sin(x)\\
    g(x) &= \frac{\sin(x^3-5(x+0.1)^2)}{x^3+(x+0.1)^{-2}}
\end{align}

この二つの関数について、ある区間$[x_{min},x_{max}]$においての最大値を求めるアルゴリズムを示していく。

全探索では探索する間隔となる$delta$を用いて$[x_{min},x_{max}]$を
この$delta$で分割したすべての$x$の値において$f(x)$を計算する。
この$x$での関数の出力値が$x-delta$の出力値よりも大きい場合にのみ、
その関数値と$x$の値をそれぞれ$fbest,xbest$で保存する。

これにより区間すべての探索が終わった際、保存されていた$fbest,xbest$がこの区間での関数の最大値となる。

山登り探索では探索する間隔$delta$と探索の初期値$x_0$を設定する。
まずその探索にあたって探索の初期値から$\pm delta$分離れた関数の値と初期値での関数の値
$f(x_0-delta),f(x_0),f(x_0+delta)$を用意する。
この3つの関数の値を比較することで、グラフのいわば登るべき方向を決めることができる。
$f(x_0-delta)$が大きければ$x$の負の方向に探索を進め、$f(x_0+delta)$が大きければ$x$の正の方向に探索を進める。
$f(x_0)$が大きいとその点が極大値となり、探索は終了する。
ここで決めた方向は$sign$に$\pm1$の値で保存され、$delta$に掛けてから$x$の値に足し算することで探索が進行する。

以降は$f(x)$と$f(x+delta)$の値を比較していき、$f(x+delta)$が大きい場合は探索を続行し、
$f(x)$の値が大きくなる場合はその点が極大値となるため、探索はそこで終了する。

これにより探索終了時の$x$と$f(x)$が出力される。

\subsection{2変数関数での探索}
最大値を求める関数は(3)(4)の2種類を用いる。
\begin{align}
    f(x_1,x_2) &= \frac{1}{2} (\sin(x_1) + \sin(x_2))\\
    g(x_1,x_2) &= \frac{1}{2} \left( \frac{\sin({x_1}^3-5(x_1+0.1)^2)}{{x_1}^3+(x_1+0.1)^{-2}} + \frac{\sin({x_2}^3-5(x_2+0.1)^2)}{{x_2}^3+(x_2+0.1)^{-2}} \right)
\end{align}

2変数関数であっても基本行うことは変わらない。そのためここでは相違点を示していく。
最大値を求める区間は$[[x_{(1)min},x_{(2)min}],[x_{(1)max},x_{(2)max}]]$となる。
全探索ではこの区間すべてにおいて探索間隔$delta$を用いて関数値$f(x_1,x_2)$を計算し、最大値を探す。

山登り探索では探索の初期値$(x_{(1)0},x_{(2)0})$と探索する間隔$delta$を同様に用意する。
変更点は探索を始める際に決める探索の向きで、1変数の際は$x$に対して正負どちらかの方向、
もしくはその場が最大値となっていたが、2変数となるので$x_1,x_2$どちらに対しても$\pm delta$したときの
関数値がどうなるかを考えなければならないため、9通りの進行方向が生まれる。

これを変更点としてソースコード\ref{hill}を\ref{hill3d}に変更している。

\section{演習結果}
以下に演習を行った結果を示す。
\subsection{1変数関数での探索}
\subsubsection{全探索}
以下ではソースコード\ref{ex}を実行したときの結果を示す。

始めに関数として(1)式を用い、探索の間隔を$0.01$、探索範囲を$[0,\pi]$としたときの結果が図\ref{es0p0.01}となる。
\begin{figure}[h]
    \centering
    \includegraphics[width=80mm]{c:/program_code/LaTeX/OPT/class2/exsearch_sin_0_3.141592653589793_0.01.png}
    \caption{(1)式を探索間隔$0.01$,探索範囲$[0,\pi]$で全探索を行った結果}
    \label{es0p0.01}
\end{figure}

計算回数は315回で得られた最大値は$f(1.5700000000000012)=0.9999996829318346$となった。
$\sin(x)$は$\frac{\pi}{2}$で最大値1を取るためおおよそ正確な値を得られている。

また探索範囲はそのままで探索の間隔を$0.001$と小さくすると計算回数3142回で得られた最大値は
$f(1.5709999999999378)=0.9999999792586128$となった。理論値との誤差を比較するとおおよそ$\frac{1}{10}$
ほど小さくなっているが計算回数が10倍と多くなってしまっている。

続いて探索する関数として(2)式を用いる。先ほどと同様探索の間隔を$0.01$、探索範囲を$[0,\pi]$としたときの結果が図\ref{ep0p0.01}となる。
\begin{figure}[h]
    \centering
    \includegraphics[width=80mm]{c:/program_code/LaTeX/OPT/class2/exsearch_p3d_0_3.141592653589793_0.01.png}
    \caption{(2)式を探索間隔$0.01$,探索範囲$[0,\pi]$で全探索を行った結果}
    \label{ep0p0.01}
\end{figure}

計算回数は315回で得られた最大値は$f(0.9500000000000006)=0.5658344662199044$となった。
すなわちおおよそ$x=0.95$で最大値となる。

このまま探索間隔を$0.001$にすることで得られた最大値は$f(0.9480000000000007)=0.5658822614470929$となった。
計算回数は例によって10倍の3142回であった。


\lstinputlisting[caption=exhaustive\_search.py, label=ex]{C:/Program_Code/Python/OPT/Class2/exhaustive_search.py}
\lstinputlisting[caption=hill\_climbing.py, label=hill]{C:/Program_Code/Python/OPT/Class2/hill_climbing.py}
\lstinputlisting[caption=exhaustive\_search\_3d.py, label=ex3d]{C:/Program_Code/Python/OPT/Class2/exhaustive_search_3d.py}
\lstinputlisting[caption=hill\_climbing\_3d.py, label=hill3d]{C:/Program_Code/Python/OPT/Class2/hill_climbing_3d.py}

\end{document}